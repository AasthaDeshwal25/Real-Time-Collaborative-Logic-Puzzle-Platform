{"ast":null,"code":"import{useEffect,useRef,useState}from'react';import{useDispatch}from'react-redux';import{Client}from'@stomp/stompjs';import SockJS from'sockjs-client';import{confirmMove,puzzleSolved}from'../store/puzzleSlice';export const useWebSocket=puzzleId=>{const dispatch=useDispatch();const[isConnected,setIsConnected]=useState(false);const clientRef=useRef(null);const reconnectCount=useRef(0);useEffect(()=>{if(!puzzleId||reconnectCount.current>=5)return;const client=new Client({webSocketFactory:()=>new SockJS('/ws'),reconnectDelay:3000,onConnect:()=>{setIsConnected(true);reconnectCount.current=0;// Listen for moves on this puzzle\nclient.subscribe(\"/topic/puzzle/\".concat(puzzleId,\"/moves\"),msg=>{const moveData=JSON.parse(msg.body);dispatch(confirmMove(moveData));});// Listen for puzzle completion\nclient.subscribe(\"/topic/puzzle/\".concat(puzzleId,\"/solved\"),msg=>{const solvedData=JSON.parse(msg.body);dispatch(puzzleSolved(solvedData));});},onDisconnect:()=>{setIsConnected(false);},onStompError:error=>{console.log('Connection error:',error);reconnectCount.current++;setIsConnected(false);}});client.activate();clientRef.current=client;return()=>{if(clientRef.current){clientRef.current.deactivate();}};},[puzzleId,dispatch]);const sendMove=moveData=>{var _clientRef$current;if((_clientRef$current=clientRef.current)!==null&&_clientRef$current!==void 0&&_clientRef$current.connected){clientRef.current.publish({destination:'/app/puzzle/move',body:JSON.stringify(moveData)});}};return{connected:isConnected,sendMove};};","map":{"version":3,"names":["useEffect","useRef","useState","useDispatch","Client","SockJS","confirmMove","puzzleSolved","useWebSocket","puzzleId","dispatch","isConnected","setIsConnected","clientRef","reconnectCount","current","client","webSocketFactory","reconnectDelay","onConnect","subscribe","concat","msg","moveData","JSON","parse","body","solvedData","onDisconnect","onStompError","error","console","log","activate","deactivate","sendMove","_clientRef$current","connected","publish","destination","stringify"],"sources":["C:/Users/aasth/OneDrive/Documents/GitHub/Real-Time-Collaborative-Logic-Puzzle-Platform/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nimport { confirmMove, puzzleSolved } from '../store/puzzleSlice';\n\nexport const useWebSocket = (puzzleId) => {\n  const dispatch = useDispatch();\n  const [isConnected, setIsConnected] = useState(false);\n  const clientRef = useRef(null);\n  const reconnectCount = useRef(0);\n\n  useEffect(() => {\n    if (!puzzleId || reconnectCount.current >= 5) return;\n\n    const client = new Client({\n      webSocketFactory: () => new SockJS('/ws'),\n      reconnectDelay: 3000,\n      onConnect: () => {\n        setIsConnected(true);\n        reconnectCount.current = 0;\n        \n        // Listen for moves on this puzzle\n        client.subscribe(`/topic/puzzle/${puzzleId}/moves`, (msg) => {\n          const moveData = JSON.parse(msg.body);\n          dispatch(confirmMove(moveData));\n        });\n        \n        // Listen for puzzle completion\n        client.subscribe(`/topic/puzzle/${puzzleId}/solved`, (msg) => {\n          const solvedData = JSON.parse(msg.body);\n          dispatch(puzzleSolved(solvedData));\n        });\n      },\n      onDisconnect: () => {\n        setIsConnected(false);\n      },\n      onStompError: (error) => {\n        console.log('Connection error:', error);\n        reconnectCount.current++;\n        setIsConnected(false);\n      },\n    });\n\n    client.activate();\n    clientRef.current = client;\n\n    return () => {\n      if (clientRef.current) {\n        clientRef.current.deactivate();\n      }\n    };\n  }, [puzzleId, dispatch]);\n\n  const sendMove = (moveData) => {\n    if (clientRef.current?.connected) {\n      clientRef.current.publish({\n        destination: '/app/puzzle/move',\n        body: JSON.stringify(moveData),\n      });\n    }\n  };\n\n  return { connected: isConnected, sendMove };\n};\n"],"mappings":"AAAA,OAASA,SAAS,CAAEC,MAAM,CAAEC,QAAQ,KAAQ,OAAO,CACnD,OAASC,WAAW,KAAQ,aAAa,CACzC,OAASC,MAAM,KAAQ,gBAAgB,CACvC,MAAO,CAAAC,MAAM,KAAM,eAAe,CAClC,OAASC,WAAW,CAAEC,YAAY,KAAQ,sBAAsB,CAEhE,MAAO,MAAM,CAAAC,YAAY,CAAIC,QAAQ,EAAK,CACxC,KAAM,CAAAC,QAAQ,CAAGP,WAAW,CAAC,CAAC,CAC9B,KAAM,CAACQ,WAAW,CAAEC,cAAc,CAAC,CAAGV,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAAAW,SAAS,CAAGZ,MAAM,CAAC,IAAI,CAAC,CAC9B,KAAM,CAAAa,cAAc,CAAGb,MAAM,CAAC,CAAC,CAAC,CAEhCD,SAAS,CAAC,IAAM,CACd,GAAI,CAACS,QAAQ,EAAIK,cAAc,CAACC,OAAO,EAAI,CAAC,CAAE,OAE9C,KAAM,CAAAC,MAAM,CAAG,GAAI,CAAAZ,MAAM,CAAC,CACxBa,gBAAgB,CAAEA,CAAA,GAAM,GAAI,CAAAZ,MAAM,CAAC,KAAK,CAAC,CACzCa,cAAc,CAAE,IAAI,CACpBC,SAAS,CAAEA,CAAA,GAAM,CACfP,cAAc,CAAC,IAAI,CAAC,CACpBE,cAAc,CAACC,OAAO,CAAG,CAAC,CAE1B;AACAC,MAAM,CAACI,SAAS,kBAAAC,MAAA,CAAkBZ,QAAQ,WAAWa,GAAG,EAAK,CAC3D,KAAM,CAAAC,QAAQ,CAAGC,IAAI,CAACC,KAAK,CAACH,GAAG,CAACI,IAAI,CAAC,CACrChB,QAAQ,CAACJ,WAAW,CAACiB,QAAQ,CAAC,CAAC,CACjC,CAAC,CAAC,CAEF;AACAP,MAAM,CAACI,SAAS,kBAAAC,MAAA,CAAkBZ,QAAQ,YAAYa,GAAG,EAAK,CAC5D,KAAM,CAAAK,UAAU,CAAGH,IAAI,CAACC,KAAK,CAACH,GAAG,CAACI,IAAI,CAAC,CACvChB,QAAQ,CAACH,YAAY,CAACoB,UAAU,CAAC,CAAC,CACpC,CAAC,CAAC,CACJ,CAAC,CACDC,YAAY,CAAEA,CAAA,GAAM,CAClBhB,cAAc,CAAC,KAAK,CAAC,CACvB,CAAC,CACDiB,YAAY,CAAGC,KAAK,EAAK,CACvBC,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEF,KAAK,CAAC,CACvChB,cAAc,CAACC,OAAO,EAAE,CACxBH,cAAc,CAAC,KAAK,CAAC,CACvB,CACF,CAAC,CAAC,CAEFI,MAAM,CAACiB,QAAQ,CAAC,CAAC,CACjBpB,SAAS,CAACE,OAAO,CAAGC,MAAM,CAE1B,MAAO,IAAM,CACX,GAAIH,SAAS,CAACE,OAAO,CAAE,CACrBF,SAAS,CAACE,OAAO,CAACmB,UAAU,CAAC,CAAC,CAChC,CACF,CAAC,CACH,CAAC,CAAE,CAACzB,QAAQ,CAAEC,QAAQ,CAAC,CAAC,CAExB,KAAM,CAAAyB,QAAQ,CAAIZ,QAAQ,EAAK,KAAAa,kBAAA,CAC7B,IAAAA,kBAAA,CAAIvB,SAAS,CAACE,OAAO,UAAAqB,kBAAA,WAAjBA,kBAAA,CAAmBC,SAAS,CAAE,CAChCxB,SAAS,CAACE,OAAO,CAACuB,OAAO,CAAC,CACxBC,WAAW,CAAE,kBAAkB,CAC/Bb,IAAI,CAAEF,IAAI,CAACgB,SAAS,CAACjB,QAAQ,CAC/B,CAAC,CAAC,CACJ,CACF,CAAC,CAED,MAAO,CAAEc,SAAS,CAAE1B,WAAW,CAAEwB,QAAS,CAAC,CAC7C,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}