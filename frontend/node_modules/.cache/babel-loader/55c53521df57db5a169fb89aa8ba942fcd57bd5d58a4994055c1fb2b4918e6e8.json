{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useRef, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nimport { confirmMove, puzzleSolved } from '../store/puzzleSlice';\nexport const useWebSocket = puzzleId => {\n  _s();\n  const dispatch = useDispatch();\n  const [isConnected, setIsConnected] = useState(false);\n  const clientRef = useRef(null);\n  const reconnectCount = useRef(0);\n  useEffect(() => {\n    if (!puzzleId || reconnectCount.current >= 5) return;\n    const client = new Client({\n      webSocketFactory: () => new SockJS('/ws'),\n      reconnectDelay: 3000,\n      onConnect: () => {\n        setIsConnected(true);\n        reconnectCount.current = 0;\n\n        // Listen for moves on this puzzle\n        client.subscribe(`/topic/puzzle/${puzzleId}/moves`, msg => {\n          const moveData = JSON.parse(msg.body);\n          dispatch(confirmMove(moveData));\n        });\n\n        // Listen for puzzle completion\n        client.subscribe(`/topic/puzzle/${puzzleId}/solved`, msg => {\n          const solvedData = JSON.parse(msg.body);\n          dispatch(puzzleSolved(solvedData));\n        });\n      },\n      onDisconnect: () => {\n        setIsConnected(false);\n      },\n      onStompError: error => {\n        console.log('Connection error:', error);\n        reconnectCount.current++;\n        setIsConnected(false);\n      }\n    });\n    client.activate();\n    clientRef.current = client;\n    return () => {\n      if (clientRef.current) {\n        clientRef.current.deactivate();\n      }\n    };\n  }, [puzzleId, dispatch]);\n  const sendMove = moveData => {\n    var _clientRef$current;\n    if ((_clientRef$current = clientRef.current) !== null && _clientRef$current !== void 0 && _clientRef$current.connected) {\n      clientRef.current.publish({\n        destination: '/app/puzzle/move',\n        body: JSON.stringify(moveData)\n      });\n    }\n  };\n  return {\n    connected: isConnected,\n    sendMove\n  };\n};\n_s(useWebSocket, \"G0mwIRR0DRp40mfUOXuhh4U+aDE=\", false, function () {\n  return [useDispatch];\n});","map":{"version":3,"names":["useEffect","useRef","useState","useDispatch","Client","SockJS","confirmMove","puzzleSolved","useWebSocket","puzzleId","_s","dispatch","isConnected","setIsConnected","clientRef","reconnectCount","current","client","webSocketFactory","reconnectDelay","onConnect","subscribe","msg","moveData","JSON","parse","body","solvedData","onDisconnect","onStompError","error","console","log","activate","deactivate","sendMove","_clientRef$current","connected","publish","destination","stringify"],"sources":["C:/Users/aasth/OneDrive/Desktop/PROJECTS/PuzzlePlatform/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nimport { confirmMove, puzzleSolved } from '../store/puzzleSlice';\n\nexport const useWebSocket = (puzzleId) => {\n  const dispatch = useDispatch();\n  const [isConnected, setIsConnected] = useState(false);\n  const clientRef = useRef(null);\n  const reconnectCount = useRef(0);\n\n  useEffect(() => {\n    if (!puzzleId || reconnectCount.current >= 5) return;\n\n    const client = new Client({\n      webSocketFactory: () => new SockJS('/ws'),\n      reconnectDelay: 3000,\n      onConnect: () => {\n        setIsConnected(true);\n        reconnectCount.current = 0;\n        \n        // Listen for moves on this puzzle\n        client.subscribe(`/topic/puzzle/${puzzleId}/moves`, (msg) => {\n          const moveData = JSON.parse(msg.body);\n          dispatch(confirmMove(moveData));\n        });\n        \n        // Listen for puzzle completion\n        client.subscribe(`/topic/puzzle/${puzzleId}/solved`, (msg) => {\n          const solvedData = JSON.parse(msg.body);\n          dispatch(puzzleSolved(solvedData));\n        });\n      },\n      onDisconnect: () => {\n        setIsConnected(false);\n      },\n      onStompError: (error) => {\n        console.log('Connection error:', error);\n        reconnectCount.current++;\n        setIsConnected(false);\n      },\n    });\n\n    client.activate();\n    clientRef.current = client;\n\n    return () => {\n      if (clientRef.current) {\n        clientRef.current.deactivate();\n      }\n    };\n  }, [puzzleId, dispatch]);\n\n  const sendMove = (moveData) => {\n    if (clientRef.current?.connected) {\n      clientRef.current.publish({\n        destination: '/app/puzzle/move',\n        body: JSON.stringify(moveData),\n      });\n    }\n  };\n\n  return { connected: isConnected, sendMove };\n};\n"],"mappings":";AAAA,SAASA,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AACnD,SAASC,WAAW,QAAQ,aAAa;AACzC,SAASC,MAAM,QAAQ,gBAAgB;AACvC,OAAOC,MAAM,MAAM,eAAe;AAClC,SAASC,WAAW,EAAEC,YAAY,QAAQ,sBAAsB;AAEhE,OAAO,MAAMC,YAAY,GAAIC,QAAQ,IAAK;EAAAC,EAAA;EACxC,MAAMC,QAAQ,GAAGR,WAAW,CAAC,CAAC;EAC9B,MAAM,CAACS,WAAW,EAAEC,cAAc,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAMY,SAAS,GAAGb,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAMc,cAAc,GAAGd,MAAM,CAAC,CAAC,CAAC;EAEhCD,SAAS,CAAC,MAAM;IACd,IAAI,CAACS,QAAQ,IAAIM,cAAc,CAACC,OAAO,IAAI,CAAC,EAAE;IAE9C,MAAMC,MAAM,GAAG,IAAIb,MAAM,CAAC;MACxBc,gBAAgB,EAAEA,CAAA,KAAM,IAAIb,MAAM,CAAC,KAAK,CAAC;MACzCc,cAAc,EAAE,IAAI;MACpBC,SAAS,EAAEA,CAAA,KAAM;QACfP,cAAc,CAAC,IAAI,CAAC;QACpBE,cAAc,CAACC,OAAO,GAAG,CAAC;;QAE1B;QACAC,MAAM,CAACI,SAAS,CAAC,iBAAiBZ,QAAQ,QAAQ,EAAGa,GAAG,IAAK;UAC3D,MAAMC,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACH,GAAG,CAACI,IAAI,CAAC;UACrCf,QAAQ,CAACL,WAAW,CAACiB,QAAQ,CAAC,CAAC;QACjC,CAAC,CAAC;;QAEF;QACAN,MAAM,CAACI,SAAS,CAAC,iBAAiBZ,QAAQ,SAAS,EAAGa,GAAG,IAAK;UAC5D,MAAMK,UAAU,GAAGH,IAAI,CAACC,KAAK,CAACH,GAAG,CAACI,IAAI,CAAC;UACvCf,QAAQ,CAACJ,YAAY,CAACoB,UAAU,CAAC,CAAC;QACpC,CAAC,CAAC;MACJ,CAAC;MACDC,YAAY,EAAEA,CAAA,KAAM;QAClBf,cAAc,CAAC,KAAK,CAAC;MACvB,CAAC;MACDgB,YAAY,EAAGC,KAAK,IAAK;QACvBC,OAAO,CAACC,GAAG,CAAC,mBAAmB,EAAEF,KAAK,CAAC;QACvCf,cAAc,CAACC,OAAO,EAAE;QACxBH,cAAc,CAAC,KAAK,CAAC;MACvB;IACF,CAAC,CAAC;IAEFI,MAAM,CAACgB,QAAQ,CAAC,CAAC;IACjBnB,SAAS,CAACE,OAAO,GAAGC,MAAM;IAE1B,OAAO,MAAM;MACX,IAAIH,SAAS,CAACE,OAAO,EAAE;QACrBF,SAAS,CAACE,OAAO,CAACkB,UAAU,CAAC,CAAC;MAChC;IACF,CAAC;EACH,CAAC,EAAE,CAACzB,QAAQ,EAAEE,QAAQ,CAAC,CAAC;EAExB,MAAMwB,QAAQ,GAAIZ,QAAQ,IAAK;IAAA,IAAAa,kBAAA;IAC7B,KAAAA,kBAAA,GAAItB,SAAS,CAACE,OAAO,cAAAoB,kBAAA,eAAjBA,kBAAA,CAAmBC,SAAS,EAAE;MAChCvB,SAAS,CAACE,OAAO,CAACsB,OAAO,CAAC;QACxBC,WAAW,EAAE,kBAAkB;QAC/Bb,IAAI,EAAEF,IAAI,CAACgB,SAAS,CAACjB,QAAQ;MAC/B,CAAC,CAAC;IACJ;EACF,CAAC;EAED,OAAO;IAAEc,SAAS,EAAEzB,WAAW;IAAEuB;EAAS,CAAC;AAC7C,CAAC;AAACzB,EAAA,CA1DWF,YAAY;EAAA,QACNL,WAAW;AAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}