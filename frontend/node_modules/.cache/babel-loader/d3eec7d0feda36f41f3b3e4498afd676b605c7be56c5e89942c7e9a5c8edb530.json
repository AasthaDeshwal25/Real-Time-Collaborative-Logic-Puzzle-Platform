{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useEffect, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nimport { setClient, setConnected, incrementReconnectAttempts } from '../store/websocketSlice';\nimport { confirmMove, puzzleSolved } from '../store/puzzleSlice';\nexport const useWebSocket = puzzleId => {\n  _s();\n  const dispatch = useDispatch();\n  const {\n    client,\n    connected,\n    reconnectAttempts,\n    maxReconnectAttempts\n  } = useSelector(state => state.websocket);\n  const connect = useCallback(() => {\n    if (client !== null && client !== void 0 && client.connected || reconnectAttempts >= maxReconnectAttempts) return;\n    const stompClient = new Client({\n      webSocketFactory: () => new SockJS('/ws'),\n      reconnectDelay: 5000,\n      heartbeatIncoming: 4000,\n      heartbeatOutgoing: 4000,\n      onConnect: () => {\n        dispatch(setConnected(true));\n        if (puzzleId) {\n          // Subscribe to puzzle moves\n          stompClient.subscribe(`/topic/puzzle/${puzzleId}/moves`, message => {\n            const move = JSON.parse(message.body);\n            dispatch(confirmMove(move));\n          });\n\n          // Subscribe to puzzle solved events\n          stompClient.subscribe(`/topic/puzzle/${puzzleId}/solved`, message => {\n            const event = JSON.parse(message.body);\n            dispatch(puzzleSolved(event));\n          });\n        }\n      },\n      onDisconnect: () => {\n        dispatch(setConnected(false));\n      },\n      onStompError: frame => {\n        console.error('STOMP error:', frame);\n        dispatch(incrementReconnectAttempts());\n        setTimeout(connect, 5000);\n      }\n    });\n    stompClient.activate();\n    dispatch(setClient(stompClient));\n  }, [client, puzzleId, reconnectAttempts, maxReconnectAttempts, dispatch]);\n  const sendMove = useCallback(move => {\n    if (client !== null && client !== void 0 && client.connected) {\n      client.publish({\n        destination: '/app/puzzle/move',\n        body: JSON.stringify(move)\n      });\n    }\n  }, [client]);\n  useEffect(() => {\n    connect();\n    return () => {\n      if (client !== null && client !== void 0 && client.connected) {\n        client.deactivate();\n      }\n    };\n  }, [connect]);\n  return {\n    connected,\n    sendMove\n  };\n};\n_s(useWebSocket, \"Qjmsq23UNWtsNekK31vwtFwQtwg=\", false, function () {\n  return [useDispatch, useSelector];\n});","map":{"version":3,"names":["useEffect","useCallback","useDispatch","useSelector","Client","SockJS","setClient","setConnected","incrementReconnectAttempts","confirmMove","puzzleSolved","useWebSocket","puzzleId","_s","dispatch","client","connected","reconnectAttempts","maxReconnectAttempts","state","websocket","connect","stompClient","webSocketFactory","reconnectDelay","heartbeatIncoming","heartbeatOutgoing","onConnect","subscribe","message","move","JSON","parse","body","event","onDisconnect","onStompError","frame","console","error","setTimeout","activate","sendMove","publish","destination","stringify","deactivate"],"sources":["C:/Users/aasth/OneDrive/Desktop/PROJECTS/PuzzlePlatform/frontend/src/hooks/useWebSocket.js"],"sourcesContent":["import { useEffect, useCallback } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Client } from '@stomp/stompjs';\nimport SockJS from 'sockjs-client';\nimport { \n  setClient, \n  setConnected, \n  incrementReconnectAttempts \n} from '../store/websocketSlice';\nimport { confirmMove, puzzleSolved } from '../store/puzzleSlice';\n\nexport const useWebSocket = (puzzleId) => {\n  const dispatch = useDispatch();\n  const { client, connected, reconnectAttempts, maxReconnectAttempts } = useSelector(\n    state => state.websocket\n  );\n\n  const connect = useCallback(() => {\n    if (client?.connected || reconnectAttempts >= maxReconnectAttempts) return;\n\n    const stompClient = new Client({\n      webSocketFactory: () => new SockJS('/ws'),\n      reconnectDelay: 5000,\n      heartbeatIncoming: 4000,\n      heartbeatOutgoing: 4000,\n      onConnect: () => {\n        dispatch(setConnected(true));\n        \n        if (puzzleId) {\n          // Subscribe to puzzle moves\n          stompClient.subscribe(`/topic/puzzle/${puzzleId}/moves`, (message) => {\n            const move = JSON.parse(message.body);\n            dispatch(confirmMove(move));\n          });\n          \n          // Subscribe to puzzle solved events\n          stompClient.subscribe(`/topic/puzzle/${puzzleId}/solved`, (message) => {\n            const event = JSON.parse(message.body);\n            dispatch(puzzleSolved(event));\n          });\n        }\n      },\n      onDisconnect: () => {\n        dispatch(setConnected(false));\n      },\n      onStompError: (frame) => {\n        console.error('STOMP error:', frame);\n        dispatch(incrementReconnectAttempts());\n        setTimeout(connect, 5000);\n      },\n    });\n\n    stompClient.activate();\n    dispatch(setClient(stompClient));\n  }, [client, puzzleId, reconnectAttempts, maxReconnectAttempts, dispatch]);\n\n  const sendMove = useCallback((move) => {\n    if (client?.connected) {\n      client.publish({\n        destination: '/app/puzzle/move',\n        body: JSON.stringify(move),\n      });\n    }\n  }, [client]);\n\n  useEffect(() => {\n    connect();\n    \n    return () => {\n      if (client?.connected) {\n        client.deactivate();\n      }\n    };\n  }, [connect]);\n\n  return { connected, sendMove };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}